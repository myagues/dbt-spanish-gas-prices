
version: 2

sources:
  - name: raw_data
    database: precios-carburantes
    schema: preciosEESS
    tables:
      - name: region
        columns:
          - name: id
            tests:
              - unique
          - name: name
            tests:
              - not_null

      - name: province
        columns:
          - name: id
            tests:
              - unique
          - name: name
            tests:
              - not_null
          - name: region_id
            tests:
              - not_null
              - relationships:
                  to: source('raw_data', 'region')
                  field: id

      - name: municipality
        columns:
          - name: id
            tests:
              - unique
          - name: name
            tests:
              - not_null
          - name: province_id
            tests:
              - not_null
              - relationships:
                  to: source('raw_data', 'province')
                  field: id

      - name: prices
        loaded_at_field: _PARTITIONTIME
        freshness:
          warn_after: {count: 24, period: hour}
        columns:
          - name: municipality
          - name: municipality_id
            tests:
              - not_null
              - relationships:
                  to: source('raw_data', 'municipality')
                  field: id
          - name: province
          - name: province_id
            tests:
              - not_null
              - relationships:
                  to: source('raw_data', 'province')
                  field: id
          - name: region_id
            tests:
              - not_null
              - relationships:
                  to: source('raw_data', 'region')
                  field: id
          - name: town
          - name: address
          - name: longitude
          - name: latitude
          - name: road_side
            tests:
              - accepted_values:
                  values: ['D', 'I', 'N']
          - name: name
            tests:
              - not_null
          - name: restriction
            tests:
              - not_null
              - accepted_values:
                  values: ['P', 'A', 'p', 'a']
          - name: sender
            tests:
              - not_null
              - accepted_values:
                  values: ['dm', 'OM']
          - name: schedule
          - name: zip_code
            tests:
              - not_null
          - name: station_id
            tests:
              - not_null
          - name: date
          - name: petrol_95E5
          - name: petrol_95E10
          - name: petrol_95E5_premium
          - name: petrol_98E5
          - name: petrol_98E10
          - name: diesel_A
          - name: diesel_B
          - name: diesel_premium
          - name: bioetanol
          - name: biodiesel
          - name: lpg
          - name: cng
          - name: lng
          - name: hydrogen
